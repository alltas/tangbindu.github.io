function SpinePlus(e,t){this.entryTime=(new Date).getTime(),this._canvas=e,this._canvas.height=this._canvas.clientHeight,this._canvas.width=this._canvas.clientWidth,t=t||{},!e&&console.error("缺少canvas"),!t.json&&console.error("缺少必要骨骼数据.json"),!t.atlas&&console.error("缺少必要骨骼材质地图.atlas"),!t.png&&console.error("缺少必要骨骼材质图片.png"),this._config={png:t.png,atlas:t.atlas,json:t.json,ratina:"undefined"==typeof t.ratina?!0:t.ratina,usewebgl:"undefined"==typeof t.usewebgl?!0:t.usewebgl,scale:t.scale||1,triangleRendering:"undefined"==typeof t.triangleRendering?!0:t.triangleRendering,debugRendering:"undefined"==typeof t.debugRendering?!1:t.debugRendering},this._usewebgl=this._config.usewebgl&&this.checkWebgl(),this._isRatina=this._config.ratina,this._ctx=null,this._atlas=null,this._atlasLoader=null,this._skeletonData=null,this._skeletonJsonData=null,this._skeletonJson=null,this._skeleton=null,this._skeletonRenderer=null,this._animationStateData=null,this._animationState=null,this.initTime=0,this.init=function(){this._config.ratina&&this.setRatina(this._canvas),this._ctx=this.getContext(this._canvas),this._assetManager=this._usewebgl?new this.webgl.AssetManager(this._ctx):new this.canvas.AssetManager(this._ctx),this._assetManager.loadText(this._config.json),this._assetManager.loadText(this._config.atlas),this._assetManager.loadTexture(this._config.png),this.loadComplete(function(){this._atlas=this.getAtlas(this._config.atlas),this._atlasLoader=new this.TextureAtlasAttachmentLoader(this._atlas),this._skeletonJson=new this.SkeletonJson(this._atlasLoader),this._skeletonJson.scale=this._config.scale,this._skeletonJsonData=this._assetManager.get(this._config.json),this._skeletonData=this._skeletonJson.readSkeletonData(this._skeletonJsonData),this._skeleton=new this.Skeleton(this._skeletonData),this._skeletonRenderer=this.getSkeletonRenderer(),this._skeletonRenderer.triangleRendering=this._config.triangleRendering,this._skeletonRenderer.debugRendering=this._config.debugRendering,this._animationStateData=new this.AnimationStateData(this._skeleton.data),this._animationState=new this.AnimationState(this._animationStateData),this.initTime=(new Date).getTime()-this.entryTime,this.trigger("ready")})}.call(this)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/30)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),SpinePlus.prototype=spine,SpinePlus.prototype.checkWebgl=function(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return t?!0:!1},SpinePlus.prototype.getContext=function(){return this._usewebgl?this._canvas.getContext("webgl",{alpha:!0,preserveDrawingBuffer:!0})||this._canvas.getContext("experimental-webgl",{alpha:!0,preserveDrawingBuffer:!0}):this._canvas.getContext("2d")},SpinePlus.prototype.getAtlas=function(e){var t=e.slice(0,e.lastIndexOf("/")+1),n=e.slice(e.lastIndexOf("/")+1),i=this;return new this.TextureAtlas(this._assetManager.get(t+n),function(e){return i._assetManager.get(t+e)})},SpinePlus.prototype.setRatina=function(e){e.width=e.clientWidth*window.devicePixelRatio,e.height=e.clientHeight*window.devicePixelRatio},SpinePlus.prototype.loadComplete=function(e){function t(){n._assetManager.isLoadingComplete()?(e&&e.call(n),n.trigger("loadComplete")):requestAnimFrame(t)}var n=this;requestAnimFrame(t)},SpinePlus.prototype.getSkeletonRenderer=function(){var e=this,t=this._usewebgl?new this.webgl.SkeletonRenderer(this._ctx):new this.canvas.SkeletonRenderer(this._ctx);return t.clean=function(){e._usewebgl?e._ctx.clear(e._ctx.COLOR_BUFFER_BIT):e._ctx.clearRect(0,0,e._canvas.width,e._canvas.height)},t},SpinePlus.prototype.render=function(e,t){var t=t||{},n={x:t.x||0,y:t.y||0};if(e.x=0+n.x,this._usewebgl){e.y=0+n.y;var i=new this.webgl.Matrix4,s=this.webgl.Shader.newColoredTextured(this._ctx),a=new this.webgl.PolygonBatcher(this._ctx);i.ortho2d(0,0,this._canvas.width,this._canvas.height),this._skeletonRenderer.clean(),e.updateWorldTransform(),s.bind(),s.setUniformi(this.webgl.Shader.SAMPLER,0),s.setUniform4x4f(this.webgl.Shader.MVP_MATRIX,i.values),a.begin(s),this._skeletonRenderer.premultipliedAlpha=!0,this._skeletonRenderer.draw(a,e),a.end(),s.unbind()}else e.y=this._canvas.height-n.y,e.flipY=!e.flipY,e.updateWorldTransform(),this._skeletonRenderer.clean(),this._skeletonRenderer.draw(e)},SpinePlus.prototype.handler=function(e,t){"undefined"==typeof this.handlers&&(this.handlers={}),"undefined"==typeof this.handlers[e]&&(this.handlers[e]=new Array),this.handlers[e]=this.handlers[e].concat(t)},SpinePlus.prototype.trigger=function(e){if("undefined"==typeof this.handlers&&(this.handlers={}),this.handlers[e]instanceof Array)for(var t=this.handlers[e],n=0,i=t.length;i>n;n++)t[n].call(this,this)},SpinePlus.prototype.renderAnimation=function(e,t){function n(){var a=Date.now()/1e3,r=a-s;return s=a,i._animationState.update(r),i._animationState.apply(e),i.render(e,t),i._animationState.tracks[0]?(requestAnimFrame(n),void 0):(i.trigger("animationEnd"),!1)}var i=this,s=Date.now()/1e3;requestAnimFrame(n)};