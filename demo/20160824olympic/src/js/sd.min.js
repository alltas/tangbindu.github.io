"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SpriteUtilities=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?PIXI:arguments[0];if(_classCallCheck(this,e),void 0===t)throw new Error("Please supply a reference to PIXI in the SpriteUtilities constructor before using spriteUtilities.js");this.renderer="",t.ParticleContainer&&t.Sprite&&(this.renderer="pixi",this.Container=t.Container,this.ParticleContainer=t.ParticleContainer,this.TextureCache=t.utils.TextureCache,this.Texture=t.Texture,this.Rectangle=t.Rectangle,this.MovieClip=t.extras.MovieClip,this.BitmapText=t.extras.BitmapText,this.Sprite=t.Sprite,this.TilingSprite=t.extras.TilingSprite,this.Graphics=t.Graphics,this.Text=t.Text,this.shakingSprites=[])}return _createClass(e,[{key:"update",value:function(){if(this.shakingSprites.length>0)for(var e=this.shakingSprites.length-1;e>=0;e--){var t=this.shakingSprites[e];t.updateShake&&t.updateShake()}}},{key:"sprite",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],i=arguments[4],a=arguments[5],u=void 0,s=void 0;if("string"==typeof e){if(s=this.TextureCache[e]?this.TextureCache[e]:this.Texture.fromImage(e),!s)throw new Error(e+" cannot be found");u=r?new this.TilingSprite(s,i,a):new this.Sprite(s)}else e instanceof this.Texture?u=r?new this.TilingSprite(e,i,a):new this.Sprite(e):e instanceof Array&&("string"==typeof e[0]?u=this.TextureCache[e[0]]?this.MovieClip.fromFrames(e):this.MovieClip.fromImages(e):e[0]instanceof this.Texture&&(u=new this.MovieClip(e)));return u?(u.x=t,u.y=n,i&&(u.width=i),a&&(u.height=a),u instanceof this.MovieClip&&this.addStatePlayer(u),u):void 0}},{key:"addStatePlayer",value:function(e){function t(t){a(),e.gotoAndStop(t)}function n(){a(),e.gotoAndStop(e.currentFrame)}function r(t){a(),t?(o=t[0],l=t[1]):(o=0,l=e.totalFrames-1),s=l-o,e.fps||(e.fps=12);var n=1e3/e.fps;e.gotoAndStop(o),u=1,e.animating||(g=setInterval(i.bind(this),n),e.animating=!0)}function i(){s+1>u?(e.gotoAndStop(e.currentFrame+1),u+=1):e.loop&&(e.gotoAndStop(o),u=1)}function a(){void 0!==g&&e.animating===!0&&(e.animating=!1,u=0,o=0,l=0,s=0,clearInterval(g))}var u=0,s=0,o=0,l=0,g=void 0;e.show=t,e.stopAnimation=n,e.playAnimation=r}},{key:"tilingSprite",value:function(e,t,n,r,i){if(void 0===t)throw new Error("Please define a width as your second argument for the tiling sprite");if(void 0===n)throw new Error("Please define a height as your third argument for the tiling sprite");var a=this.sprite(e,r,i,!0,t,n);return Object.defineProperties(a,{tileX:{get:function(){return a.tilePosition.x},set:function(e){a.tilePosition.x=e},enumerable:!0,configurable:!0},tileY:{get:function(){return a.tilePosition.y},set:function(e){a.tilePosition.y=e},enumerable:!0,configurable:!0},tileScaleX:{get:function(){return a.tileScale.x},set:function(e){a.tileScale.x=e},enumerable:!0,configurable:!0},tileScaleY:{get:function(){return a.tileScale.y},set:function(e){a.tileScale.y=e},enumerable:!0,configurable:!0}}),a}},{key:"filmstrip",value:function(e,t,n){for(var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=[],a=this.TextureCache[e].width,u=this.TextureCache[e].height,s=a/t,o=u/n,l=s*o,g=0;l>g;g++){var h=g%s*t,m=Math.floor(g/s)*n;r>0&&(h+=r+r*g%s,m+=r+r*Math.floor(g/s)),i.push([h,m])}return this.frames(e,i,t,n)}},{key:"frame",value:function(e,t,n,r,i){var a=void 0,u=void 0;if("string"==typeof e?this.TextureCache[e]&&(a=new this.Texture(this.TextureCache[e])):e instanceof this.Texture&&(a=new this.Texture(e)),a)return u=new this.Rectangle(t,n,r,i),a.frame=u,a;throw new Error("Please load the "+e+" texture into the cache.")}},{key:"frames",value:function(e,t,n,r){var i=this,a=void 0;if("string"==typeof e?this.TextureCache[e]&&(a=new this.Texture(this.TextureCache[e])):e instanceof this.Texture&&(a=new this.Texture(e)),a){var u=t.map(function(e){var t=e[0],u=e[1],s=new i.Rectangle(t,u,n,r),o=new i.Texture(a);return o.frame=s,o});return u}throw new Error("Please load the "+e+" texture into the cache.")}},{key:"frameSeries",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"":arguments[2],r=arguments.length<=3||void 0===arguments[3]?"":arguments[3],i=[],a=e;t+1>a;a++){var u=this.TextureCache[""+(n+a+r)];i.push(u)}return i}},{key:"text",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"message":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"16px sans":arguments[1],n=arguments.length<=2||void 0===arguments[2]?"red":arguments[2],r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?0:arguments[4],a=new this.Text(e,{font:t,fill:n});return a.x=r,a.y=i,a._content=e,Object.defineProperty(a,"content",{get:function(){return this._content},set:function(e){this._content=e,this.text=e},enumerable:!0,configurable:!0}),a}},{key:"bitmapText",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"message":arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],i=arguments.length<=4||void 0===arguments[4]?0:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=new this.BitmapText(e,{font:t,align:n,tint:r});return u.x=i,u.y=a,u._content=e,Object.defineProperty(u,"content",{get:function(){return this._content},set:function(e){this._content=e,this.text=e},enumerable:!0,configurable:!0}),u}},{key:"rectangle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?32:arguments[0],t=arguments.length<=1||void 0===arguments[1]?32:arguments[1],n=arguments.length<=2||void 0===arguments[2]?16724736:arguments[2],r=arguments.length<=3||void 0===arguments[3]?13260:arguments[3],i=arguments.length<=4||void 0===arguments[4]?0:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],s=new this.Graphics;s._sprite=void 0,s._width=e,s._height=t,s._fillStyle=this.color(n),s._strokeStyle=this.color(r),s._lineWidth=i;var o=function(e,t,n,r,i){s.clear(),s.beginFill(n),i>0&&s.lineStyle(i,r,1),s.drawRect(0,0,e,t),s.endFill()};o(s._width,s._height,s._fillStyle,s._strokeStyle,s._lineWidth);var l=s.generateTexture(),g=new this.Sprite(l);g.x=a,g.y=u;var h=this;return Object.defineProperties(g,{fillStyle:{get:function(){return s._fillStyle},set:function(e){s._fillStyle=h.color(e),o(s._width,s._height,s._fillStyle,s._strokeStyle,s._lineWidth,s._x,s._y);var t=s.generateTexture();s._sprite.texture=t},enumerable:!0,configurable:!0},strokeStyle:{get:function(){return s._strokeStyle},set:function(e){s._strokeStyle=h.color(e),o(s._width,s._height,s._fillStyle,s._strokeStyle,s._lineWidth,s._x,s._y);var t=s.generateTexture();s._sprite.texture=t},enumerable:!0,configurable:!0},lineWidth:{get:function(){return s._lineWidth},set:function(e){s._lineWidth=e,o(s._width,s._height,s._fillStyle,s._strokeStyle,s._lineWidth,s._x,s._y);var t=s.generateTexture();s._sprite.texture=t},enumerable:!0,configurable:!0}}),s._sprite=g,g}},{key:"circle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?32:arguments[0],t=arguments.length<=1||void 0===arguments[1]?16724736:arguments[1],n=arguments.length<=2||void 0===arguments[2]?13260:arguments[2],r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?0:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=new this.Graphics;u._diameter=e,u._fillStyle=this.color(t),u._strokeStyle=this.color(n),u._lineWidth=r;var s=function(e,t,n,r){u.clear(),u.beginFill(t),r>0&&u.lineStyle(r,n,1),u.drawCircle(0,0,e/2),u.endFill()};s(u._diameter,u._fillStyle,u._strokeStyle,u._lineWidth);var o=u.generateTexture(),l=new this.Sprite(o);l.x=i,l.y=a;var g=this;return Object.defineProperties(l,{fillStyle:{get:function(){return u._fillStyle},set:function(e){u._fillStyle=g.color(e),s(u._diameter,u._fillStyle,u._strokeStyle,u._lineWidth);var t=u.generateTexture();u._sprite.texture=t},enumerable:!0,configurable:!0},strokeStyle:{get:function(){return u._strokeStyle},set:function(e){u._strokeStyle=g.color(e),s(u._diameter,u._fillStyle,u._strokeStyle,u._lineWidth);var t=u.generateTexture();u._sprite.texture=t},enumerable:!0,configurable:!0},diameter:{get:function(){return u._diameter},set:function(){u._lineWidth=10,s(u._diameter,u._fillStyle,u._strokeStyle,u._lineWidth);var e=u.generateTexture();u._sprite.texture=e},enumerable:!0,configurable:!0},radius:{get:function(){return u._diameter/2},set:function(e){s(2*e,u._fillStyle,u._strokeStyle,u._lineWidth);var t=u.generateTexture();u._sprite.texture=t},enumerable:!0,configurable:!0}}),u._sprite=l,l}},{key:"line",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?32:arguments[4],a=arguments.length<=5||void 0===arguments[5]?32:arguments[5],u=new this.Graphics;u._strokeStyle=this.color(e),u._width=t,u._ax=n,u._ay=r,u._bx=i,u._by=a;var s=function(e,t,n,r,i,a){u.clear(),u.lineStyle(t,e,1),u.moveTo(n,r),u.lineTo(i,a)};s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by);var o=this;return Object.defineProperties(u,{ax:{get:function(){return u._ax},set:function(e){u._ax=e,s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0},ay:{get:function(){return u._ay},set:function(e){u._ay=e,s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0},bx:{get:function(){return u._bx},set:function(e){u._bx=e,s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0},by:{get:function(){return u._by},set:function(e){u._by=e,s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0},strokeStyle:{get:function(){return u._strokeStyle},set:function(e){u._strokeStyle=o.color(e),s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0},width:{get:function(){return u._width},set:function(e){u._width=e,s(u._strokeStyle,u._width,u._ax,u._ay,u._bx,u._by)},enumerable:!0,configurable:!0}}),u}},{key:"grid",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?32:arguments[2],r=arguments.length<=3||void 0===arguments[3]?32:arguments[3],i=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],s=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],o=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8],l=new this.Container,g=function(){for(var g=e*t,h=0;g>h;h++){var m=h%e*n,c=Math.floor(h/e)*r,f=s();l.addChild(f),i?(f.x=m+n/2-f.width/2+a,f.y=c+r/2-f.width/2+u):(f.x=m+a,f.y=c+u),o&&o(f)}};return g(),l}},{key:"shoot",value:function(e,t,n,r,i,a,u,s){var o=s();o.anchor.set(.5,.5),e.addChild(o),o.x=n,o.y=r;var l=o.getGlobalPosition().x,g=o.getGlobalPosition().y;i.addChild(o),o.x=l,o.y=g,o.vx=Math.cos(t)*a,o.vy=Math.sin(t)*a,u.push(o)}},{key:"grid",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?32:arguments[2],r=arguments.length<=3||void 0===arguments[3]?32:arguments[3],i=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],s=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],o=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8],l=this.group(),g=function(){for(var g=e*t,h=0;g>h;h++){var m=h%e*n,c=Math.floor(h/e)*r,f=s();l.addChild(f),i?(f.x=m+n/2-f.halfWidth+a,f.y=c+r/2-f.halfHeight+u):(f.x=m+a,f.y=c+u),o&&o(f)}};return g(),l}},{key:"shake",value:function(e){function t(){s>u&&(e.x=o,e.y=l,r-=h,e.x+=m(-r,r),e.y+=m(-r,r),u+=1),u>=s&&(e.x=o,e.y=l,a.shakingSprites.splice(a.shakingSprites.indexOf(e),1))}function n(){s>u&&(e.rotation=g,r-=h,e.rotation=r*c,u+=1,c*=-1),u>=s&&(e.rotation=g,a.shakingSprites.splice(a.shakingSprites.indexOf(e),1))}var r=arguments.length<=1||void 0===arguments[1]?16:arguments[1],i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],a=this,u=1,s=10,o=e.x,l=e.y,g=e.rotation,h=r/s,m=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};-1===a.shakingSprites.indexOf(e)&&(a.shakingSprites.push(e),e.updateShake=function(){i?n():t()});var c=1}},{key:"_getCenter",value:function(e,t,n){return void 0!==e.anchor?0!==e.anchor[n]?0:t/2:t}},{key:"group",value:function(){for(var e=new this.Container,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return n.forEach(function(t){e.addChild(t)}),e}},{key:"batch",value:function(){var e=arguments.length<=0||void 0===arguments[0]?15e3:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{rotation:!0,alpha:!0,scale:!0,uvs:!0}:arguments[1],n=new this.ParticleContainer(e,t);return n}},{key:"remove",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];if(t[0]instanceof Array){var r=t[0];if(r.length>0)for(var i=r.length-1;i>=0;i--){var a=r[i];a.parent.removeChild(a),r.splice(r.indexOf(a),1)}}else t.length>1?t.forEach(function(e){e.parent.removeChild(e)}):t[0].parent.removeChild(t[0])}},{key:"colorToRGBA",value:function(e){var t,n;t=document.createElement("canvas"),t.height=1,t.width=1,n=t.getContext("2d"),n.fillStyle=e,n.fillRect(0,0,1,1);var r=n.getImageData(0,0,1,1).data;return r}},{key:"byteToHex",value:function(e){return("0"+e.toString(16)).slice(-2)}},{key:"colorToHex",value:function(e){var t,n,r=this;return t=this.colorToRGBA(e),n=[0,1,2].map(function(e){return r.byteToHex(t[e])}).join(""),"0x"+n}},{key:"color",value:function(e){return isNaN(e)?this.colorToHex(e):e}}]),e}();